<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíñ–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ö—É–∫–æ–ª –¥–ª—è –º–æ–µ–π –ª—é–±–∏–º–æ–π! ü§´</title>
    ¬† ¬† 
    <link rel="stylesheet" href="dolls.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
</head>
<body>

    <header>
        <h1>–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¥–ª—è –º–æ–µ–π –ª—é–±–∏–º–æ–π! ü§´</h1>
        <p>–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫—É–∫–ª—ã —Å –∫–∞–Ω–∞–ª–∞ ü´ßkabi_mlpü´ß <br>
            –Ø –ø–æ–¥—É–º–∞–ª —á—Ç–æ —Ç—ã –¥–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ —Ç–∞–º —Å–∏–¥–∏—à—å –∞ –≤ —Ç–≥ –Ω–µ—É–¥–æ–±–Ω–æ. ‚ù§Ô∏è</p>
    </header>

    <main>
        <section id="marketplace">
            <h2>üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥ –ö—É–∫–æ–ª</h2>
            
            <div class="filter-controls">
                <button id="filter-all" class="active" onclick="filterDolls('all')">–í—Å–µ</button>
                <button id="filter-stock" onclick="filterDolls('stock')">–í –Ω–∞–ª–∏—á–∏–∏</button>
                <button id="filter-preorder" onclick="filterDolls('preorder')">–ü—Ä–µ–¥–∑–∞–∫–∞–∑</button>
            </div>
            
            <div id="dolls-container" class="doll-grid">
                <p>‚åõ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</p>
                </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –¥–µ—Ç–∞–ª—è–º.</p>
    </footer>
    
    <script>
        // –í–µ—Å—å JavaScript-–∫–æ–¥ –æ—Å—Ç–∞–ª—Å—è –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å —Ñ–∞–π–ª—ã
        const JSON_URL = '/static/dolls_data.json';
        let allDollsData = []; 
        
        // === –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–• ===
        async function loadDolls() {
            try {
                const response = await fetch(JSON_URL);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
                }
                
                allDollsData = await response.json();
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                allDollsData.sort((a, b) => {
                    if (a.is_preorder && !b.is_preorder) return -1;
                    if (!a.is_preorder && b.is_preorder) return 1;
                    return b.id - a.id; 
                });

                renderDolls(allDollsData); 

            } catch (error) {
                console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫—É–∫–æ–ª:", error);
                document.getElementById('dolls-container').innerHTML = 
                    '<p class="error-message">üòî –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ!</p>';
            }
        }

        // === –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ö–ê–†–¢–û–ß–ï–ö ===
        function renderDolls(dollsArray) {
            const container = document.getElementById('dolls-container');
            container.innerHTML = ''; 

            if (dollsArray.length === 0) {
                container.innerHTML = '<p>üíñ –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç. –ó–∞–≥–ª—è–Ω–∏ –ø–æ–∑–∂–µ!</p>';
                return;
            }

            dollsArray.forEach(doll => {
                const card = document.createElement('div');
                card.classList.add('doll-card');
                
                const isPreorder = doll.is_preorder;
                const statusText = isPreorder ? 'üî• –ü—Ä–µ–¥–∑–∞–∫–∞–∑' : '‚ú® –í –Ω–∞–ª–∏—á–∏–∏';
                
                // –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç —Ö–µ—à—Ç–µ–≥–æ–≤
                const cleanedText = doll.text
                    .replace(/#\w+/g, '') 
                    .replace(/\n\s*\n/g, '\n') 
                    .trim();

                const title = cleanedText.split('\n')[0].trim() || "–ö—É–∫–ª–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
                
                // –û–ø–∏—Å–∞–Ω–∏–µ: –±–µ—Ä–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                let description = cleanedText.split('\n').slice(1).join('\n').trim();
                if (description.length === 0) {
                    description = cleanedText.trim();
                }
                description = description.length > 150 ? description.substring(0, 150).trim() + '...' : description;


                // === –ë–õ–û–ö –¶–ï–ù–´ ===
                let priceHtml = '';
                if (doll.price) {
                    let deliveryTag = '';
                    if (doll.delivery_price) {
                        deliveryTag = `<span class="delivery-price">+ ${doll.delivery_price} –¥—Å</span>`;
                    }
                    
                    priceHtml = `
                        <div class="price-tag">
                            <span class="main-price">${doll.price}</span>
                            ${deliveryTag}
                        </div>
                    `;
                }
                // ===============================

                card.innerHTML = `
                    <div class="doll-status ${isPreorder ? 'preorder' : 'stock'}">${statusText}</div>
                    <img src="${doll.photo_path || '/placeholder.jpg'}" alt="${title}">
                    <div class="card-body">
                        <h3>${title}</h3>
                        ${priceHtml} 
                        <p class="description">${description}</p>
                    </div>
                    <div class="card-actions">
                        <a href="${doll.link}" target="_blank" class="buy-button">
                            <i class="fas fa-shopping-cart"></i> ${isPreorder ? '–û–±—Å—É–¥–∏—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑' : '–ö—É–ø–∏—Ç—å'}
                        </a>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // === –§–£–ù–ö–¶–ò–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–ò ===
        function filterDolls(filterType) {
            let filteredData = [];

            // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
            document.querySelectorAll('.filter-controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`filter-${filterType}`).classList.add('active');


            if (filterType === 'all') {
                filteredData = allDollsData;
            } else if (filterType === 'stock') {
                filteredData = allDollsData.filter(doll => !doll.is_preorder);
            } else if (filterType === 'preorder') {
                filteredData = allDollsData.filter(doll => doll.is_preorder);
            }
            
            renderDolls(filteredData);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadDolls();
    </script>
</body>

</html>
